<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Second Assignment</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__r_e_a_d_m_e.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Second Assignment </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This repo contains a project for second assignment for Research Track I course.</p>
<h1><a class="anchor" id="autotoc_md0"></a>
The Goal</h1>
<p>The task was to create a ROS package, with three nodes:</p><ol type="1">
<li>A node that implements an action client, allowing the user to set a target (x, y) or to cancel it.<ul>
<li>The node also publishes the robot position and velocity as a custom message (x,y, vel_x, vel_z), by relying on the values published on the topic</li>
</ul>
</li>
<li>Service node that, when called, should return the coordinates of the last target sent by the user</li>
<li>Another service node that gets to the robot's current position and average speed.</li>
</ol>
<h1><a class="anchor" id="autotoc_md1"></a>
Installing and running</h1>
<h2><a class="anchor" id="autotoc_md2"></a>
1. Installing</h2>
<p>In order to use this project, package <a href="https://github.com/CarmineD8/assignment_2_2023">assignment_2_2023</a> is required.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
2. Run</h2>
<p>To successfully run the project in predefine scenario, the author advises to use <code>roslaunch</code> command.</p>
<div class="fragment"><div class="line">roslaunch rt_assignment_2 assignment_2.launch</div>
</div><!-- fragment --><p>In the .launch file there is an arg <code>av_window_size</code> (the window size for average speed calculation) which can be additionally set by the user while running eg:</p>
<div class="fragment"><div class="line">roslaunch rt_assignment_2 test.launch av_window_size:=123</div>
</div><!-- fragment --><p>If the argument is not set the parameter takes the default value of 10.</p>
<p>The user may also run all the nodes seperately using <code>rosrun</code>.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Project overview and structure</h1>
<h2><a class="anchor" id="autotoc_md5"></a>
1. Controls</h2>
<p>According to the tasks of the assignment, the user may set or cancel goal for action server. Additionally to that, there are services that, when called return the latest robot target, or the distance to that target and average speed in both x,y directions</p>
<h3><a class="anchor" id="autotoc_md6"></a>
Set new target</h3>
<p>In order to set the new target, the user should publish new message onto <code>/robot_target</code> topic. The type of message to be published is <code>rt_assignment_2/RobotTarget</code></p>
<div class="fragment"><div class="line">rostopic pub /robot_target rt_assignment_2/RobotTarget &quot;{x: 3.5, y: 3}&quot;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md7"></a>
Cancel the goal</h3>
<p>Similarly to the previous example, in order to cancel the goal the user should publish new message onto <code>/robot_cancel_goal</code> topic. The type is <code>rt_assignment_2/RobotCancelGoal</code>, but the message is empty.</p>
<div class="fragment"><div class="line">rostopic pub /robot_cancel_goal rt_assignment_2/RobotCancelGoal</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md8"></a>
Get the last target (service)</h3>
<p>To get the latest target set by the user, the service <code>/get_last_target</code> needs to be called. If there was no target yet set. The node will log a warning and return 0 in both x,y coordinates.</p>
<div class="fragment"><div class="line">rosservice call /get_last_target </div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md9"></a>
Get target distance</h3>
<p>To get the distance to the target, the user needs to call the <code>/get_target_distance</code> service.</p>
<div class="fragment"><div class="line">rosservice call /get_target_distance </div>
</div><!-- fragment --><p>This service returns 5 values.</p><ul>
<li>dist - distance to the target</li>
<li>dist_x, dist_y - distances in both x and y</li>
<li>av_speed_x, av_speed_y - robot speed in both x and y</li>
</ul>
<h2><a class="anchor" id="autotoc_md10"></a>
2. The structure</h2>
<p>Project was built using both C++ and Python scripts. In <code>src/</code> there are two files: <code>set_target_node.cpp</code> and <code>main.cpp</code>. The first one provides definitions of member functions of a class <em>SetTargetNode</em>, which is declared in <code>include/rt_assignment_2/set_target_node.hpp</code>.</p>
<p>Main function is used only to initialize the most important components and spin ros node.</p>
<div class="fragment"><div class="line">Main Function:</div>
<div class="line">  Initialize ROS node</div>
<div class="line">  Create ROS node handle</div>
<div class="line">  Create Action Client to PlanningAction</div>
<div class="line">  Try:</div>
<div class="line">    Create SetTargetNode object with Action Client and Node Handle</div>
<div class="line">    Log &quot;set_target_node ready&quot;</div>
<div class="line">    Spin ROS</div>
<div class="line">  Catch exception:</div>
<div class="line">    Log exception message</div>
<div class="line">  Log &quot;Shutting down&quot;</div>
<div class="line">  Shutdown ROS</div>
<div class="line">  Return 0</div>
</div><!-- fragment --><p>While most of the logic is hidden inside the constructor of <em>SetTargetNode</em> .</p>
<div class="fragment"><div class="line">SetTargetNode Class:</div>
<div class="line">  Constructor:</div>
<div class="line">    Store Action Client and Node Handle</div>
<div class="line">    Log &quot;Waiting for server to connect&quot;</div>
<div class="line">    Waitfor Action Server to connect</div>
<div class="line">    Subscribe to &quot;/robot_target&quot; with setNewTargetCallback</div>
<div class="line">    Subscribe to &quot;/odom&quot; with robotStateCallback</div>
<div class="line">    Subscribe to &quot;/robot_cancel_goal&quot; with cancelGoalCallback</div>
<div class="line">    Advertise &quot;/robot_state&quot; to publish robot state</div>
<div class="line">    Create timer to actualPoseCallback with 0.5 seconds interval</div>
</div><!-- fragment --><p>The logic based on callbacks to subscribers, publisher, and a timer, to get various information</p>
<div class="fragment"><div class="line">actualPoseCallback Function:</div>
<div class="line">    If Action Client state is ACTIVE:</div>
<div class="line">      Log current robot position (feedback_pos_x_, feedback_pos_y_)</div>
<div class="line"> </div>
<div class="line">  cancelGoalCallback Function:</div>
<div class="line">    Cancel the current goal using Action Client</div>
<div class="line">    Log &quot;Robot&#39;s goal is canceled&quot;</div>
<div class="line"> </div>
<div class="line">  setNewTargetCallback Function:</div>
<div class="line">    Log &quot;New Target arrived&quot;</div>
<div class="line">    Create PlanningGoal with target coordinates from received message</div>
<div class="line">    Send the goal using Action Client</div>
<div class="line">    Log &quot;New Goal has been sent&quot;</div>
<div class="line"> </div>
<div class="line">  robotStateCallback Function:</div>
<div class="line">    Create RobotState message from received Odometry message</div>
<div class="line">    Publish the RobotState message to &quot;/robot_state&quot;</div>
<div class="line"> </div>
<div class="line">  doneCallback Function:</div>
<div class="line">    Log the goal finishing state and result</div>
<div class="line">    Log &quot;Select new target by publishing into /robot_target&quot;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md11"></a>
# Further improvements</h2>
<p>In author's opinion these could be additional changes to improve the project:</p><ul>
<li>[ ] Change the rostopic pub messages into rosservices. Current state is a bit clunky and doesnt come in hande to simply cancel the goal or set new target. Use of services would be much more compact here.</li>
<li>[ ] In some cases, it would be better to use standard messages instead of custom ones (eg. /robot_cancel_goal) </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
